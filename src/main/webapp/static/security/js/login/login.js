function reloadImage(){var e=$.trim($("#loginName").val());document.getElementById("verified").src="/code.do?loginName="+e+"&ts="+(new Date).getTime()}function loginConfirm(){var e=$("#phoneCode").val();return""==e||null==e?(error='<label class="error msg-error" >验证码为空！</label>',void $(".error-text1").html(error)):void $.ajax({type:"GET",async:"true",url:"/loginMessage/userCheckMessage.do",data:{code:e,loginTekon:login_token},success:function(e){return 200!=e.status?(error='<label class="error msg-error" >'+e.msg+"</label>",void $(".error-text1").html(error)):(url=e.data,void(window.location.href=url))},error:function(){error='<label class="error msg-error" >程序异常！</label>',$(".error-text1").html(error)}})}function login(){var e=$.trim($("#loginName").val());if("undefined"==e||0==e.length)return void $(".error-text").html("请输入账号");var r=$.trim($("#passWord").val());if("undefined"==r||0==r.length)return void $(".error-text").html("请输入密码 ");e=Base64.encode(e),r=Base64.encode(r+"_"+randomDate);var o=$("#verifiedCode").val();$("#passWord").val(""),$("#verifiedCode").val("");var a="/usercentre/login.do";$.ajax({type:"post",url:a,data:{verifiedCode:o,loginName:e,password:r},async:!1,success:function(e){if(e)if(200==e.status)if(a=e.data,"/views/home.html"==a)window.location.href=a;else{$("#phone_div").show(),$("#login_div").hide();var r=a.split("|"),o=r[0];login_token=r[1],$("#phone").html(o),$("#phone_div").delegate("#get-code","click",sendSMSCode)}else 500==e.status&&(error='<label class="error msg-error" >'+e.msg+"</label>",$(".error-text").html(error)),null!=e.data&&e.data.errorCount>=3&&($("#inputCode").show(),reloadImage()),$("#loginName").focus()},error:function(){alert("登录失败！")}})}require.config({baseUrl:"../../static/common/js",paths:{jquery:"libs/jquery/jquery-1.11.3.min",validate:"libs/jquery/jquery-validation/jquery.validate.min","validator.addMethod":"libs/jquery/jquery-validation/jQuery.validator.addMethod",base64:"libs/base64"},shim:{jquery:{exports:"$"},validate:["jquery"],"validator.addMethod":["jquery","validate"]}});var login_token="",randomDate="";require(["jquery","validate","validator.addMethod","base64"],function(e){e(document).ready(function(){e("#loginName").blur("click",function(){var r=e.trim(e("#loginName").val());return"undefined"==r||0==r.length?void e(".error-text").html("请输入账号"):void e.ajax({type:"post",url:"/usercentre/randomNum.do",data:{account:r},async:!1,success:function(e){randomDate=e.data}})}),e("#denglu").on("click",function(){login()}),e("#denglu").keyup(function(){13==event.keyCode&&login()}),e("#passWord").keyup(function(){13==event.keyCode&&login()})})});var sendSMSCode=function(){$.ajax({type:"POST",async:"true",url:"/loginMessage/findUserMessage.do",data:{loginTekon:login_token},success:function(e){if(200==e.status){$("#reget-code").css("display","inline-block"),$("#get-code").css("display","none"),$("#phone_div").undelegate("#get-code","click",sendSMSCode);var r=300,o=setInterval(function(){r-=1,$("#time").html("("+r+")"),0==r&&($("#get-code").css("display","inline-block"),$("#reget-code").css("display","none"),clearInterval(o),r=300,$("#time").html("("+r+")"),$("#phone_div").delegate("#get-code","click",sendSMSCode))},1e3)}else e.msg?(error='<label class="error msg-error" >'+e.msg+"</label>",$(".error-text1").html(error)):(error='<label class="error msg-error" >登录过期，请重新登录</label>',$(".error-text1").html(error)),$("#get-code").val("获取手机验证码")},error:function(){error='<label class="error msg-error" >程序异常！</label>',$(".error-text1").html(error)}})};